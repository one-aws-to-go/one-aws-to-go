generator client {
  provider      = "prisma-client-js"
  ///output        = "../build/node_modules/.prisma/client"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  githubId Int    @id
  forks    Fork[]
}

model ForkTemplate {
  id       Int          @id @default(autoincrement())
  owner    String
  repo     String
  provider String
  forks    Fork[]
  actions  ForkAction[]
}

model ForkAction {
  key              String
  githubActionName String
  toState          String
  templateId       Int
  template         ForkTemplate @relation(fields: [templateId], references: [id])

  @@unique([key, templateId])
}

model Fork {
  id             Int          @id @default(autoincrement())
  appName        String       @unique
  owner          String
  userId         Int
  templateId     Int
  actionsEnabled Boolean      @default(false)
  ref            String       @default("master")
  secretsSet     Boolean      @default(false)
  state          String
  template       ForkTemplate @relation(fields: [templateId], references: [id])
  user           User         @relation(fields: [userId], references: [githubId])
}
